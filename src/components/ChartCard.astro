---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  src: string | ImageMetadata;
  alt: string;
  caption: string;
  title?: string;
  bgColor?: 'white' | 'default';
}

const { src, alt, caption, title, bgColor = 'default' } = Astro.props;

const backgrounds = {
  white: 'bg-white border-slate-200',
  default: 'bg-[#0f1f3a]/50 border-white/10',
};

const innerBackgrounds = {
  white: 'bg-slate-50',
  default: 'bg-[#0a1628]/50',
};

// Check if src is an optimized image import (ImageMetadata) or a legacy string path
const isOptimizedImage = typeof src !== 'string';
---

<figure class={`${backgrounds[bgColor]} rounded-2xl p-6 my-8 border`}>
  {title && (
    <h3 class={`text-base font-semibold mb-4 ${bgColor === 'white' ? 'text-slate-900' : 'text-white'}`}>
      {title}
    </h3>
  )}
  <div class={`${innerBackgrounds[bgColor]} rounded-xl p-8 mb-4`}>
    {isOptimizedImage ? (
      <Image 
        src={src as ImageMetadata}
        alt={alt}
        class="w-full h-auto"
        loading="lazy"
        widths={[400, 600, 800, 1000, 1200]}
        sizes="(max-width: 768px) 100vw, (max-width: 1024px) 80vw, 60vw"
      />
    ) : (
      <img 
        src={src as string}
        alt={alt}
        class="w-full h-auto"
        loading="lazy"
      />
    )}
  </div>
  <figcaption class={`text-sm text-center ${bgColor === 'white' ? 'text-slate-600' : 'text-slate-400'}`}>
    {caption}
  </figcaption>
</figure>
